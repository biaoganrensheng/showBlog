<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>mpvue (二) - Blog - 努力的人生</title>
	<meta name="description" content="mpvue">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
	<link rel="shortcut icon" href="/assets/img/blog.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/assets/img/blog.ico">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/blog.ico">
	<link rel="apple-touch-icon" sizes="114x114" href="/assets/img/blog.ico">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#311e3e">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#311e3e">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#311e3e">
	
	
	
	
	<!-- Google Fonts 1
	<link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">-->
	
	
	
	
	
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/font-awesome.min.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/assets/css/main.css">

	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>  
	
	
	<!--百度统计-->
	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "https://hm.baidu.com/hm.js?660ee541ef48f4a94f8a59dd0f9e64ae";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>
	
	
	
	
	
	
	
	<!--谷歌统计-->
	<!-- Global site tag (gtag.js) - Google Analytics 
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113644888-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-113644888-1');
	</script>-->

</head>

<body>
  <div class="flex-container">
  <header class="main-header">
  <div class="wrapper">
    <div class="header-flex">
      <div class="menu-icon-container">
        <span class="menu-icon"><i class="fa fa-bars" aria-hidden="true"></i></span>
      </div>
      <nav class="main-nav">
        <span class="menu-icon-close"><i class="fa fa-times" aria-hidden="true"></i></span>
        <!--<ul style="height:800px;overflow-y:scroll;overflow-y:auto;"> -->
        <ul>
		 
			 
			 

			 

			 

			 

			 

       

       

       

       

       

       

       

       

       
       
			 <li><a  href="/"  data-hover="所有">所有(78)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

       

       

       

       

       

       

       

       
       
			 <li><a  href="/blog/markdown"  data-hover="Markdown">Markdown(4)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

       

       

       

       

       

       

       

       
       
			 <li><a  href="/blog/essays"  data-hover="随笔">随笔(6)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

       

       

       

       

       

       

       

       
       
			 <li><a  href="/blog/jekyll"  data-hover="Jekyll">Jekyll(1)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

       

       

       

       

       

       

       

       
       
			 <li><a  href="/blog/vue"  data-hover="Vue">Vue(4)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

       

       

       

       

       

       

       

       
       
			 <li><a  href="/blog/react"  data-hover="React">React(2)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

       

       

       

       

       

       

       

       
       
			 <li><a  href="/blog/anglur"  data-hover="Anglur">Anglur(1)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

       

       

       

       

       

       

       

       
       
			 <li><a  href="/blog/youman"  data-hover="构建工具">构建工具(7)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

       

       

       

       

       

       

       

       
       
			 <li><a  href="/blog/nginx2"  data-hover="Nginx2">Nginx2(1)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

       

       

       

       

       

       

       

       
       
			 <li><a  href="/blog/python"  data-hover="Python">Python(2)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

       

       

       

       

       

       

       

       
       
			 <li><a  href="/blog/abouttest"  data-hover="测试相关">测试相关(6)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

       

       

       

       

       

       

       

       
       
			 <li><a  href="/blog/aboutweb"  data-hover="前端相关">前端相关(16)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

       

       

       

       

       

       

       

       
       
			 <li><a  href="/blog/wechat"  data-hover="Wechat">Wechat(21)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

       

       

       

       

       

       

       

       
       
			 <li><a  href="/blog/other"  data-hover="其它">其它(7)</a></li>
		 
          <!--<li style="margin-bottom:200px;"><a href="/about">About(7)</a></li>-->
        </ul>
      </nav>
      <p class="logo"><a href="/">nldrs</a></p>


		<div class="navbar-container">

		<div class="search-icon"><a><i class="fa fa-search" aria-hidden="true"></i></a></div>

			<div class="navbar-menu">
			   
				<a href="/"  data-hover="Home">Home</a>  <!--title="访问 Home"-->
				<!--<a href="/">Home</a>-->
					
				<a href="/about"  data-hover="About">About</a>  <!--title="访问 About"-->
				<!--<a href="/about">About</a>-->
					
			</div>


			<div class="navbar-mobile-menu" onclick="">
				<span class="icon-menu cross"><span class="middle"></span></span>
				<ul>
				   
					 <li><a href="/"data-hover="Home">Home</a></li>  <!--title="访问 Home"-->
					 <!--<li><a href="/">Home</a></li>-->
				   
					 <li><a href="/about"data-hover="About">About</a></li>  <!--title="访问 About"-->
					 <!--<li><a href="/about">About</a></li>-->
				   
				</ul>
			</div>



		</div>

    <!--  <div class="search-icon-container">
	    <a href="/" style="text-decoration: none; color: inherit;margin-right:20px;">Home</a>
		<a href="/about" style=" text-decoration: none; color: inherit;margin-right:20px;">About</a>
        <span class="search-icon"><a><i class="fa fa-search" aria-hidden="true"></i></a></span>
      </div> -->


    </div>
  </div>
</header> <!-- End Header -->

  <article class="article-page">
    <div class="page-image">
      <div class="cover-image" style="background: url(/assets/img/lpf-19.jpg) center no-repeat; background-size: cover;"></div>
    </div>
    <div class="wrapper">
      <div class="page-content">
        <div class="header-page">
          <h1 class="page-title">mpvue (二)</h1>
          <div class="page-date"><time datetime="2018-09-04 09:12:00 +0800">2018, Sep 04</time>
		  <span id="busuanzi_container_page_pv"> | 访问量：<span id="busuanzi_value_page_pv"></span> 次</span>
		  </div>
        </div>
        <h1 id="mpvue">mpvue</h1>

<p>由于mpvue采用的是Vue框架的基础设施，所以大部分的功能都是和Vue一致的。但是，mpvue的代码毕竟最终还是要转译成小程序原生框架下的代码的，由于小程序框架本身存在的一些功能限制，导致有些功能不能被翻译过去，也就是说有些标准的Vue功能在mpvue下是不可以使用或有特殊限制的。</p>

<p>今天我们就来罗列一下，在使用mpvue的时候那些需要特别注意的点。</p>

<ol>
  <li>在模板中，动态插入HTML的v-html指令不可用
这条很好理解，小程序的界面并不是基于浏览器的BOM/DOM的，所以不能动态的在界面模板里直接插入HTML片段来显示。</li>
</ol>

<p>题外话，如果有在小程序里插入html片段的需求怎么办？可以用<rich-text>组件或者wxParse(https://github.com/icindy/wxParse)来实现。</rich-text></p>

<ol>
  <li>在模板中，用于数据绑定的双括号语法中的表达式功能存在诸多限制
在Vue本身的模板内双括号语法中，我们可以对绑定变量进行比较丰富的处理，比如：</li>
</ol>

<p>可以调用methods下的函数， 例如：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">msg</span><span class="p">:</span> <span class="s2">"Hello,World"</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">formatMessage</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s1">','</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">'#'</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre></div></div>

<p>如果变量是对象的话，也可以调用对象的成员方法</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span></code></pre></div></div>

<p>可以使用过滤器来处理变量，最有用的场景算是格式化数据了</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">可以使用过滤器来处理变量，最有用的场景算是格式化数据了</span>
</code></pre></div></div>

<p>以上这些好用的功能，在mpvue中，记得都是通通不能用的哦！！！</p>

<p>我们只能在双括号中使用一些简单的运算符运算（+ - * % ?: ! == === &gt; &lt; [] .）。</p>

<p>但是也得找些可用的替代方案呐，大伙先考虑使用计算属性(computed)来做吧。</p>

<ol>
  <li>在模板中，除事件监听外，其余地方都不能调用methods下的函数
在Vue中，模板里调用methods部分定义的函数是非常常见的，比如下面这段代码所示，在v-if指令中调用函数getErrorNum()：</li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">v</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="s2">"getErrorNum() &gt; 0  &amp;&amp; code == 10001"</span> <span class="kd">class</span><span class="o">=</span><span class="s2">"error"</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span></code></pre></div></div>

<p>可是，在mpvue里就是不可以用！因为在小程序原生模板wxml里就不支持这种函数调用，导致mpvue没有很好的方式转译过去（虽然小程序有wxs，但是感觉翻译过去mpvue要做的工作会比较复杂）。</p>

<p>所以，可用的替代方案可能还是计算属性了。</p>

<ol>
  <li>在模板中，不支持直接绑定一个对象到style或class属性上
在Vue中我们可以为HTML元素的class或style绑定一个对象，并按照对象内的属性值来决定是否添加对应的属性名到HTML元素的样式名。示例如下：</li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">div</span> <span class="p">:</span><span class="kd">class</span><span class="o">=</span><span class="s2">"classObject"</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">classObject</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">active</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s1">'text-danger'</span><span class="p">:</span> <span class="kc">false</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre></div></div>
<p>上面这段代码的运行后生成的HTML将是：</p>

<p><code class="highlighter-rouge">&lt;div class="active"&gt;&lt;/div&gt;</code></p>

<p>但是在mpvue下面这个特性也不能用，按官方说法是由于涉及到一些性能相关的原因。那如果要动态改变组件的class该怎么写呢？官方给出的方式是这样的：</p>

<p><code class="highlighter-rouge">&lt;div :class="{ active: classObject.active, 'text-danger': classObject['text-danger']}"&gt;&lt;/div&gt;</code></p>

<p>其实改动不大，稍微多打了一些字而已，相当于在模板的class里再定义一个对象罢了。但是据文档中说这样会提升性能。好吧，为了性能，这点麻烦还是能忍受的。但是它又说了：从性能考虑，建议不要过度依赖此……看来即使这样，也还是有性能问题。</p>

<p>看来最好一点的方案，还是得使用计算属性，直接生成一串样式的字符串，绑定到class或style上：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">div</span> <span class="p">:</span><span class="kd">class</span><span class="o">=</span><span class="s2">"classStr"</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">classObject</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">active</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s1">'text-danger'</span><span class="p">:</span> <span class="kc">false</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">computed</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">classStr</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">p</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">classObject</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">classObject</span><span class="p">[</span><span class="nx">p</span><span class="p">])</span> <span class="p">{</span>
          <span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span> 
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre></div></div>

<ol>
  <li>事件处理中的注意点
在mpvue中，一般可以使用Web的DOM事件名来绑定事件，mpvue会将Web事件名映射成对应的小程序事件名，对应列表如下：</li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 左侧为WEB事件 : 右侧为对应的小程序事件</span>
<span class="p">{</span>
    <span class="nl">click</span><span class="p">:</span> <span class="s1">'tap'</span><span class="p">,</span>
    <span class="nx">touchstart</span><span class="p">:</span> <span class="s1">'touchstart'</span><span class="p">,</span>
    <span class="nx">touchmove</span><span class="p">:</span> <span class="s1">'touchmove'</span><span class="p">,</span>
    <span class="nx">touchcancel</span><span class="p">:</span> <span class="s1">'touchcancel'</span><span class="p">,</span>
    <span class="nx">touchend</span><span class="p">:</span> <span class="s1">'touchend'</span><span class="p">,</span>
    <span class="nx">tap</span><span class="p">:</span> <span class="s1">'tap'</span><span class="p">,</span>
    <span class="nx">longtap</span><span class="p">:</span> <span class="s1">'longtap'</span><span class="p">,</span>
    <span class="nx">input</span><span class="p">:</span> <span class="s1">'input'</span><span class="p">,</span>
    <span class="nx">change</span><span class="p">:</span> <span class="s1">'change'</span><span class="p">,</span>
    <span class="nx">submit</span><span class="p">:</span> <span class="s1">'submit'</span><span class="p">,</span>
    <span class="nx">blur</span><span class="p">:</span> <span class="s1">'blur'</span><span class="p">,</span>
    <span class="nx">focus</span><span class="p">:</span> <span class="s1">'focus'</span><span class="p">,</span>
    <span class="nx">reset</span><span class="p">:</span> <span class="s1">'reset'</span><span class="p">,</span>
    <span class="nx">confirm</span><span class="p">:</span> <span class="s1">'confirm'</span><span class="p">,</span>
    <span class="nx">columnchange</span><span class="p">:</span> <span class="s1">'columnchange'</span><span class="p">,</span>
    <span class="nx">linechange</span><span class="p">:</span> <span class="s1">'linechange'</span><span class="p">,</span>
    <span class="nx">error</span><span class="p">:</span> <span class="s1">'error'</span><span class="p">,</span>
    <span class="nx">scrolltoupper</span><span class="p">:</span> <span class="s1">'scrolltoupper'</span><span class="p">,</span>
    <span class="nx">scrolltolower</span><span class="p">:</span> <span class="s1">'scrolltolower'</span><span class="p">,</span>
    <span class="nx">scroll</span><span class="p">:</span> <span class="s1">'scroll'</span>
<span class="p">}</span>
</code></pre></div></div>

<p>除了上面的之外，Web表单组件<input />和<textarea>的change事件会被转为blur事件。</textarea></p>

<p>然后，像keydown、keypress之类的键盘事件也没有了，因为小程序没有键盘，所以不需要这些事件。</p>

<p>还有，Vue里面绑定事件的时候，可以指定事件修饰符，但是在mpvue里，官方给出了一些注意信息：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> .stop 的使用会阻止冒泡，但是同时绑定了一个非冒泡事件，会导致该元素上的 catchEventName 失效！【这个亲测了一下，感觉是最新版本里修复了还是怎么的，没有文档里说的这个问题了】

  .prevent 可以直接干掉，因为小程序里没有什么默认事件，比如submit并不会跳转页面【也就是不需要支持】

  .capture 支持 1.0.9 【也就是在 mpvue 1.0.9及以后版本支持】

  .self 没有可以判断的标识 【也就是不支持】

   .once 也不能做，因为小程序没有 removeEventListener, 虽然可以直接在 handleProxy 中处理，但非常的不优雅，违背了原意，暂不考虑【也就是不支持】
</code></pre></div></div>

<ol>
  <li>对于表单，请直接使用小程序原生的表单组件
一句话，表单组件又多又复杂，框架可能Hold不住。所以在实际开发中，推荐直接使用小程序的表单组件标签来写，而不是使用Web的表单组件标签来写。当然了，在mpvue中使用了小程序的组件标签，数据绑定功能还是完全可以用的。给个示例：</li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">picker</span> <span class="p">@</span><span class="nd">change</span><span class="o">=</span><span class="s2">"handlePickerChange"</span> <span class="p">:</span><span class="nx">value</span><span class="o">=</span><span class="s2">"selectedIndex"</span> <span class="p">:</span><span class="nx">range</span><span class="o">=</span><span class="s2">"messages"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">view</span> <span class="kd">class</span><span class="o">=</span><span class="s2">"picker"</span><span class="o">&gt;</span><span class="err">当前消息：</span><span class="o">&lt;</span><span class="sr">/view</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/picker</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">data</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">selectedIndex</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="na">messages</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Hello'</span><span class="p">,</span> <span class="s1">'World'</span><span class="p">,</span> <span class="s1">'Haha'</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">handlePickerChange</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre></div></div>

<p>其他注意事项
另外，在Vue开发Web应用的时候，通常使用vue-router来进行页面路由。但是在mpvue小程序开发中，不能用这种方式，请使用<a>标签和小程序原生API wx.navigateTo等来做路由功能。</a></p>

<p>还有就是请求后端数据，我们通常在Web开发中使用axios等ajax库来实现，但是在小程序开发中也是不能用的，也请使用小程序的原生API wx.request等来进行。</p>

<hr />

<p>如果你使用过原生的小程序框架，你一定经历过或思考过怎么解决以下的问题：</p>

<p>怎么存放可全局访问的变量？
页面跳转的时候，怎么传递参数到下一个页面比较好？
页面返回上一页的时候，怎么传递当前页的数据到上一页？
多个页面间需要同步数据，怎么做比较好？</p>

<p>网上一搜，解决的方法通常也是五花八门的，什么通过app上的globalData啊、通过存取storage啊、通过一个单独的模块(module)啊、通过Page路由栈啊、通过引入自定义事件啊、通过引入redux啊，等等等等……</p>

<p>在原生小程序框架里，确实没有提供什么太统一的方式来指导开发者解决这个问题，大家只能各自用着暂时能解决当前问题的方案。</p>

<p>不过，既然我们用了Vue/mpvue，遇到这种情况，自然而然的就会想到一个方案，那就是Vuex。Vuex 是一个专为 Vue 应用程序开发的状态管理模式，它采用集中式存储管理应用的所有组件的状态，并以相应的规则保证状态以一种可预测的方式发生变化。</p>

<p>通过使用Vuex，我们可以在mpvue里很方便的对需要在app、页面、组件之间共享的数据进行很好的统一管理，可以更方便有效的在各个代码部分对这些共享数据进行访问，同时可以使得你的代码条理变得更加清晰。</p>

<p>我们知道，Vuex一般有2种用法，当创建好store后：</p>

<p>第一种用法是将store绑定到需要访问store内容的Vue实例上，然后通过该Vue实例下组件的this.$store来引用；或通过mapState等一系列映射函数将store中的state、getters、mutations、actions等映射成组件的计算属性或methods方法来使用；</p>

<p>第二种用法是直接在组件中通过import导入store所在的模块文件，然后调用该store上的相关方法和属性，比如commit()、dispatch()等方法来操作store中的内容。</p>

<p>经过我的实测，上面的这两种方式在mpvue中也都是可用的。但是，由于mpvue不像Vue Web单页应用那种单Vue实例的结构，而是采用了多Vue实例的结构（app和各个页面都会由单独的Vue实例来管理），所以我个人推荐采用上面所说的第二种用法，这种方式会更加灵活和简单一些。</p>

<p>让我们开始写代码，先在src目录下新建一个stores目录，接着在stores目录下新建一个名为global-store.js的文件：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="s1">'vue'</span>
<span class="k">import</span> <span class="nx">Vuex</span> <span class="k">from</span> <span class="s1">'vuex'</span><span class="p">;</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">Vuex</span><span class="p">);</span>

<span class="k">export</span> <span class="k">default</span> <span class="k">new</span> <span class="nx">Vuex</span><span class="p">.</span><span class="nx">Store</span><span class="p">({</span>
  <span class="na">state</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">count</span><span class="p">:</span> <span class="mi">0</span>
  <span class="p">},</span>
  <span class="na">mutations</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">increment</span><span class="p">:</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">state</span><span class="p">.</span><span class="nx">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="na">decrement</span><span class="p">:</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">state</span><span class="p">.</span><span class="nx">count</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>在这个代码中，我们新建了一个Store实例，管理了一个名为count的数字类型的状态，并定义了2个mutations去操作（增减）这个状态值。</p>

<p>接着，我们要在2个页面中访问这个store。让我们在src/pages目录下编写2个页面：index和test1。</p>

<p>这是pages/index/index.vue的代码内容：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">div</span> <span class="kd">class</span><span class="o">=</span><span class="s2">"container"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="err">计数结果：</span><span class="mi">8</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">"/pages/test1/main"</span> <span class="kd">class</span><span class="o">=</span><span class="s2">"navlink"</span><span class="o">&gt;</span><span class="err">进入计数器页面</span><span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="k">import</span> <span class="nx">globalStore</span> <span class="k">from</span> <span class="s2">"../../stores/global-store"</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">computed</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">count</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">globalStore</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">style</span> <span class="nx">scoped</span><span class="o">&gt;</span>
<span class="p">.</span><span class="nx">navlink</span> <span class="p">{</span>
  <span class="nx">text</span><span class="o">-</span><span class="na">decoration</span><span class="p">:</span> <span class="nx">underline</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/style</span><span class="err">&gt;
</span></code></pre></div></div>

<p>这是pages/test1/index.vue的代码内容：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">div</span> <span class="kd">class</span><span class="o">=</span><span class="s2">"container btns"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">button</span> <span class="kd">class</span><span class="o">=</span><span class="s2">"calbtn"</span> <span class="p">@</span><span class="nd">click</span><span class="o">=</span><span class="s2">"hanleDecrement"</span><span class="o">&gt;-&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">span</span> <span class="kd">class</span><span class="o">=</span><span class="s2">"calnum"</span><span class="o">&gt;</span><span class="mi">8</span><span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">button</span> <span class="kd">class</span><span class="o">=</span><span class="s2">"calbtn"</span> <span class="p">@</span><span class="nd">click</span><span class="o">=</span><span class="s2">"hanleIncrement"</span><span class="o">&gt;+&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="k">import</span> <span class="nx">globalStore</span> <span class="k">from</span> <span class="s2">"../../stores/global-store"</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">computed</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">count</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">globalStore</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">hanleIncrement</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">globalStore</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s2">"increment"</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">hanleDecrement</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">globalStore</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s2">"decrement"</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">style</span> <span class="nx">scoped</span><span class="o">&gt;</span>
<span class="p">.</span><span class="nx">btns</span> <span class="p">{</span>
  <span class="na">display</span><span class="p">:</span> <span class="nx">flex</span><span class="p">;</span>
  <span class="nx">align</span><span class="o">-</span><span class="na">items</span><span class="p">:</span> <span class="nx">center</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nx">calnum</span> <span class="p">{</span>
  <span class="na">color</span><span class="p">:</span> <span class="nx">red</span><span class="p">;</span>
  <span class="nx">font</span><span class="o">-</span><span class="na">size</span><span class="p">:</span> <span class="mi">32</span><span class="nx">px</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/style</span><span class="err">&gt;
</span></code></pre></div></div>

<p>这样，我们就有了2个使用了我们定义的global-store的页面，这些页面都会从store中获取count状态值并显示；在test1页面中，还会调用increment和decrement两个mutations去更新count值。</p>

<p>运行小程序，可以看到初始进入index页面时是这样的，页面上显示的计数结果是0：</p>

<p><img src="http://ww1.sinaimg.cn/large/006uNFWmgy1fuxdo9qavyj30uc0ou42m.jpg" alt="" /></p>

<p><img src="http://ww1.sinaimg.cn/large/006uNFWmgy1fuxdos9k6dj30vm0fcacp.jpg" alt="" /></p>

<p><a href="https://www.jianshu.com/p/2c363ea29cda">转载自简书大神’一斤代码’的博文</a></p>

        <div class="page-footer">
          <div class="page-tag">
            <span>Tags:</span>
            
            <a href="/tags#Wechat" class="tag">| Wechat</a>
            
            <a href="/tags#mpvue" class="tag">| mpvue</a>
            
          </div><!-- End Tags -->
          <div class="page-share">
            <span>Share:</span>
            <a href="https://twitter.com/intent/tweet?text=mpvue (二)&url=http://localhost:4000/mpvue2/" title="Share on Twitter" rel="nofollow" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
            <a href="https://facebook.com/sharer.php?u=http://localhost:4000/mpvue2/" title="Share on Facebook" rel="nofollow" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a>
            <a href="https://plus.google.com/share?url=http://localhost:4000/mpvue2/" title="Share on Google+" rel="nofollow" target="_blank"><i class="fa fa-google" aria-hidden="true"></i></a>
						
			<!-- JiaThis Button BEGIN -->
			<div class="jiathis_style_32x32">
				<a class="jiathis_button_weixin"></a>
				<a class="jiathis_button_tsina"></a>
				<!--<a class="jiathis_button_tqq"></a>
				<a class="jiathis_button_qzone"></a>
				<a class="jiathis_button_renren"></a>-->
				<a href="http://www.jiathis.com/share?uid=2157296" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
				<a class="jiathis_counter_style"></a>
			</div>
			<script type="text/javascript">var jiathis_config = {data_track_clickback:'true'};</script>
			<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=2157296" charset="utf-8"></script>
			<!-- JiaThis Button END -->
          </div><!-- End Share -->
		  
		
		  
		  <section>
			<!--<div style="background:#000;border-bottom: 1px solid #d9d9d9;"></div> -->

            <div class="content-play">
              <p><a href="javascript:void(0)" onclick="dashangToggle()" class="dashang" title="打赏，支持一下">打赏一下呗</a></p>
              <div class="hide_box-play"></div>
              <div class="shang_box-play">
                <a class="shang_close-play" href="javascript:void(0)" onclick="dashangToggle()" title="关闭"><img src="/assets/img/close.jpg" alt="取消" /></a>
                <div class="shang_tit-play">
                  <p>对你有帮助，那就打赏一下吧</p>
                </div>
				
				<div class="shang_payimg">    
                    <img src="/assets/img/wechatimg.jpg" alt="扫码支持" title="扫一扫"/>
                </div>
				
				 <div class="pay_item" data-id="weipay">
                    <span class="pay_logo"><img src="/assets/img/wechat.jpg" alt="微信" /></span>
                  </div>
				
                <div class="shang_payimg">
                    <img src="/assets/img/alipayimg.jpg" alt="扫码支持" title="扫一扫" />
                </div>
				
				 <div class="pay_item checked" data-id="alipay">
                    <span class="pay_logo"><img src="/assets/img/alipay.jpg" alt="支付宝" /></span>
                  </div>
				
                <div class="pay_explain">扫码打赏,金额随意</div>
               
              </div>
            </div>
            <script type="text/javascript">
            function dashangToggle(){
              $(".hide_box-play").fadeToggle();
              $(".shang_box-play").fadeToggle();
            }
            </script>

            <div style="text-align:center;margin:50px 0; font:normal 14px/24px 'MicroSoft YaHei';"></div>

            <style type="text/css">
              .content-play{width:100%;margin-top: 20px;margin-bottom: 10px;height:40px;text-align:center;}
              .hide_box-play{z-index:999;filter:alpha(opacity=50);background:#666;opacity: 0.5;-moz-opacity: 0.5;left:0;top:0;height:99%;width:100%;position:fixed;display:none;}
              .shang_box-play{width:100%;height:540px;padding:10px;background-color:#fff;border-radius:10px;position:fixed;z-index:1000;left:0%;top:50%;margin-left:0px;margin-top:-280px;border:1px dotted #dedede;display:none;}
              .shang_box-play img{border:none;border-width:0;}
              .dashang{width:100px;margin:5px auto;height:25px;line-height:25px;padding:10px;background-color:#E74851;color:#fff;text-align:center;text-decoration:none;border-radius:10px;font-weight:bold;font-size:16px;transition: all 0.3s;}
              .dashang:hover{opacity:0.8;padding:15px;font-size:18px;}
              .shang_close-play{float:right;display:inline-block;
                margin-right: 10px;margin-top: 20px;
              }
              .shang_logo{display:block;text-align:center;margin:20px auto;}
              .shang_tit-play{width: 100%;height: 75px;text-align: center;line-height: 66px;color: #a3a3a3;font-size: 16px;background: url('/images/payimg/cy-reward-title-bg.jpg');font-family: 'Microsoft YaHei';margin-top: 7px;margin-right:2px;}
              .shang_tit-play p{color:#a3a3a3;text-align:center;font-size:16px;}
              .shang_payimg{padding:10px;/*border:6px solid #EA5F00;**/margin:0 auto;border-radius:3px;height:140px;display:inline-block;}
              .shang_payimg img{display:inline-block;margin-right:10px;float:left;text-align:center;width:140px;height:140px; }
              .pay_explain{text-align:center;margin:10px auto;font-size:12px;color:#545454;}
              .shang_payselect{text-align:center;margin:0 auto;margin-top:40px;cursor:pointer;height:60px;width:500px;margin-left:110px;}
              .shang_payselect .pay_item{display:inline-block;margin-right:140px;float:left;}
              .shang_info-play{clear:both;}
              .shang_info-play p,.shang_info-play a{color:#C3C3C3;text-align:center;font-size:12px;text-decoration:none;line-height:2em;}
            </style>

       <ul class="pager">
	    
        <li class="previous">
            <a href="/mpvue3/" data-toggle="tooltip" data-placement="top" title="mpvue (三)">上一篇：  <span>mpvue (三)</span>
            </a>
        </li>
		
		<br><br>
		
        
        
        <li class="next">
            <a href="/mpvue1/" data-toggle="tooltip" data-placement="top" title="mpvue (一)">下一篇：  <span>mpvue (一)</span>
            </a>
        </li>
        
    </ul>
</section>

        </div>
		
		
        <section class="author-box">
  <img src="/assets/img/leach-face.jpg" alt="nldrs" class="author-img">
  <div class="author-desc">
    <h2>nldrs</h2>
    <p>码农，嘿说你呢！！？</p>
    <ul>
      
        <li class="email"><a href="mailto:lpfwch777@gmail.com"><i class="fa fa-envelope-o"></i></a></li>
      
      
        <li class="phone"><a href="tel:0"><i class="fa fa-phone"></i></a></li>
      
      <!--
        <li class="website"><a href="https://artemsheludko.github.io" target="_blank"><i class="fa fa-globe" aria-hidden="true"></i></a></li>
      
      
        <li class="twitter"><a href="https://twitter.com/artemsheludko_" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
      -->
    </ul>
  </div>
</section>

        <div class="recent-box">
  <h2 class="recent-title">Recent post</h2>
  <div class="recent-list">
    
      
        <a href="/mysql/" class="recent-item" style="background: url(/assets/img/lpf-10.jpg) center no-repeat; background-size: cover;"><span>mysql 学习</span></a>
      
    
      
        <a href="/uniapp6/" class="recent-item" style="background: url(/assets/img/lpf-50.jpg) center no-repeat; background-size: cover;"><span>uni-app 的总结(echarts)</span></a>
      
    
      
        <a href="/work/" class="recent-item" style="background: url(/assets/img/wch6.jpg) center no-repeat; background-size: cover;"><span>入职的第二周</span></a>
      
    
      
        <a href="/arr/" class="recent-item" style="background: url(/assets/img/wch4.jpg) center no-repeat; background-size: cover;"><span>JavaScript 数组去重</span></a>
      
    
  </div>
</div> <!-- End Recent-Box -->

        <div class="newsletter" id="mc_embed_signup" style="display:none">
  <h2 class="newsletter-title">Newsletter</h2>
  <div class="form-container">
    <p>Subscribe here to get our latest updates</p>
    <form action="//" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
      <label class="screen-reader-text" for="mce-EMAIL">Email Address</label>
      <div class="newsletter-box" id="mc_embed_signup_scroll">
        <input type="email" name="EMAIL" placeholder="Email address" class="email-input" id="mce-EMAIL" required>
        <input type="submit" value="Subscribe" name="subscribe" class="subscribe-btn" id="mc-embedded-subscribe">
      </div>
    </form>
  </div>
</div> <!-- End Newsletter -->

        <section class="comment-area">
  <div class="comment-wrapper">
   
	  <div id="disqus_thread" class="article-comments"></div>
	    <script>
			var idcomments_acct = '8b1583de29c0b1f23510ee43fce7d4e7';
			var idcomments_post_id;
			var idcomments_post_url;
		</script>
		<span id="IDCommentsPostTitle" style="display:none"></span>
		<script type='text/javascript' src='https://www.intensedebate.com/js/genericCommentWrapperV2.js'></script>
	
  </div>
</section>
      </div>
    </div> <!-- End Wrapper -->
  </article>
  <div class="search-box">
  <div class="wrapper">
    <div class="search-grid">
      <form class="search-form">
        <div id="search-container">
          <input type="text" id="search-input" class="search" placeholder="Search">
        </div>
      </form>
      <ul id="results-container" class="results-search"  style="height:400px;overflow-y:scroll;overflow-y:auto;"></ul>
      <div class="icon-close-container">
        <span class="search-icon-close"><i class="fa fa-times" aria-hidden="true"></i></span>
      </div>
    </div>
  </div>
</div>

  <footer class="main-footer">
	<div class="footer-social">
		<div class="footer-container clearfix">
			<div class="social-list">
				<a class="social github" target="blank" href="https://github.com/nldrs">GitHub</a>
				<a class="social github" target="blank" href="https://www.jianshu.com/u/042fe873dc7c">简书</a>
				<a class="social github" target="blank" href="https://juejin.im/user/5a20a378f265da4311200031/collections">掘金</a>
				<a class="social github" target="blank" href="http://blog.csdn.net/">Csdn</a>
			</div>
		</div>
	</div>

	<div class="copyright">
		<p>2018 &copy; nldrs</p>
		
			
	<div style="font-size:12px;color:#B3B3B3;padding-right:30px;float:right"> 
		<iframe
                style="margin-left: 2px; margin-bottom:-5px;"
                frameborder="0" scrolling="0" width="91px" height="20px"
                src="https://ghbtns.com/github-btn.html?user=leach-chen&repo=leach-chen.github.io&type=star&count=true" >
            </iframe>
		<span id="busuanzi_container_site_pv">本站总访问量：<span id="busuanzi_value_site_pv"></span>次</span>
	</div>
	</div>

</footer> <!-- End Footer -->

</div>

  
  
<div class="top" title="Top"><i class="fa fa-chevron-up" aria-hidden="true"></i></div> <!-- End Top Scroll -->
  <!-- JS -->
<script src="/assets/js/jquery-3.2.1.min.js"></script>
<script src="/assets/js/jekyll-search.js"></script>
<script>
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('results-container'),
    json: '/search.json',
    searchResultTemplate: '<li><a href="{url}" title="{desc}">{title}</a></li>',
    noResultsText: 'No results found',
    fuzzy: false,
    exclude: ['Welcome']
  });
</script>
<script src="/assets/js/main.js"></script>

  <!--<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', '', 'auto');
  ga('send', 'pageview');
</script> <!-- End Analytics -->

</body>
</html>
